{
    "app-id": "org.daa.NeovimGtk",
    "runtime": "org.gnome.Platform",
    "runtime-version": "3.24",
    "sdk": "org.gnome.Sdk",
    "command": "nvim-gtk",
    "finish-args": [
        "--share=ipc",
        "--socket=x11",
        "--socket=wayland",
        "--filesystem=host:rw",
        "--filesystem=~/.config/nvim:ro",
        "--share=network",
        "--socket=pulseaudio"
    ],
    "cleanup": ["/app/rustc"],
    "modules": [
        {
            "name":"rust",
            "sources": [
                {
                    "type": "archive",
                    "only-arches": ["i386"],
                    "url": "https://static.rust-lang.org/dist/rust-1.20.0-i686-unknown-linux-gnu.tar.gz",
                    "sha256": "abe592e06616cdc2fcca56ddbe482050dd49a1fada35e2af031c64fe6eb14668"
                },
                {
                    "type": "archive",
                    "only-arches": ["arm"],
                    "url": "https://static.rust-lang.org/dist/rust-1.20.0-arm-unknown-linux-gnueabihf.tar.gz",
                    "sha256": "d8282b04619acdcbb5259ba5a3c8677716a015cfef3ba68ba24211590c5bb5dc"
                },
                {
                    "type": "archive",
                    "only-arches": ["aarch64"],
                    "url": "https://static.rust-lang.org/dist/rust-1.20.0-aarch64-unknown-linux-gnu.tar.gz",
                    "sha256": "eaab3df489d4d8f976c4327d812b9870730eed6d0bbd52712767083d02be7472"
                },
                {
                    "type": "archive",
                    "only-arches": ["x86_64"],
                    "url": "https://static.rust-lang.org/dist/rust-1.20.0-x86_64-unknown-linux-gnu.tar.gz",
                    "sha256": "ca1cf3aed73ff03d065a7d3e57ecca92228d35dc36d9274a6597441319f18eb8"
                }
            ],
            "buildsystem": "simple",
            "build-commands": [
                "./install.sh --prefix=/app/rustc"
            ]
        },
        {
            "name": "libtool",
            "sources": [
                {
                    "type": "archive",
                    "url": "http://ftpmirror.gnu.org/libtool/libtool-2.4.6.tar.gz",
                    "sha256": "e3bd4d5d3d025a36c21dd6af7ea818a2afcd4dfc1ea5a17b39d7854bcd0c06e3"
                }
            ]
        },
        /* Neovim dependencies from third-party */
        {
            "name": "libuv",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/libuv/libuv/archive/v1.12.0.tar.gz",
                    "sha256": "41ce914a88da21d3b07a76023beca57576ca5b376c6ac440c80bc581cbca1250"
                }
            ]
        },

        {
            "name": "msgpack-c",
            "buildsystem": "cmake",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/msgpack/msgpack-c/archive/cpp-2.1.3.tar.gz",
                    "sha256": "42ff5c213fd24bd4388c45c1f21d84b476678ce6366ea4d4f4086618a1d2cd23"
                }
            ]
        },

        {
            "name": "LuaJIT",
            "buildsystem": "simple",
            "build-commands": [
                "sed -i \"s|/usr/local|/app|\" ./src/luaconf.h",
                "make", 
                "make PREFIX=\"/app\" install"			  
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/LuaJIT/LuaJIT/archive/82151a4514e6538086f3f5e01cb8d4b22287b14f.tar.gz",
                    "sha256": "8bc4e96ebab74e12ab84e751360e864714289bb089b51b6f396fa9a97df69798"
                }
            ]
        },

        {
            "name": "unibilium",
            "buildsystem": "simple",
            "build-commands": [
                "make", 
                "make PREFIX=\"/app\" install"			  
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/mauke/unibilium/archive/v1.2.0.tar.gz",
                    "sha256": "623af1099515e673abfd3cae5f2fa808a09ca55dda1c65a7b5c9424eb304ead8"
                }
            ]
        },

        {
            "name": "libtermkey",
            "buildsystem": "simple",
            "build-commands": [
                "make", 
                "make PREFIX=\"/app\" install"			  
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://www.leonerd.org.uk/code/libtermkey/libtermkey-0.20.tar.gz",
                    "sha256": "6c0d87c94ab9915e76ecd313baec08dedf3bd56de83743d9aa923a081935d2f5"
                }
            ]
        },

        {
            "name": "libvterm",
            "buildsystem": "simple",
            "build-commands": [
                "make", 
                "make PREFIX=\"/app\" install"			  
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/neovim/libvterm/archive/a9c7c6fd20fa35e0ad3e0e98901ca12dfca9c25c.tar.gz",
                    "sha256": "1a4272be91d9614dc183a503786df83b6584e4afaab7feaaa5409f841afbd796"
                }
            ]
        },

        {
            "name": "jemalloc",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/jemalloc/jemalloc/releases/download/4.5.0/jemalloc-4.5.0.tar.bz2",
                    "sha256": "9409d85664b4f135b77518b0b118c549009dc10f6cba14557d170476611f6780"
                }
            ]
        },

        {
            "name": "gperf",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://ftp.gnu.org/pub/gnu/gperf/gperf-3.1.tar.gz",
                    "sha256": "588546b945bba4b70b6a3a616e80b4ab466e3f33024a352fc2198112cdbb3ae2"
                }
            ]
        },

        {
            "name": "luarocks",
            "buildsystem": "simple",
            "build-commands": [
                "./configure --with-lua=/app --prefix=/app --lua-suffix=jit --with-lua-include=/app/include/luajit-2.0 --force-config",
                "make build",
                "make install"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/luarocks/luarocks/archive/v2.4.2.tar.gz",
                    "sha256": "eef88c2429c715a7beb921e4b1ba571dddb7c74a250fbb0d3cc0d4be7a5865d9"
                }
            ]
        },

        {
            "name": "luarucks-mods",
            "buildsystem": "simple",
            "build-options": {
                "build-args": ["--share=network"]
            },
            "build-commands": [
                "luarocks build lpeg 1.0.1-1",
                "luarocks build mpack 1.0.6-0"
            ]
        },

        {
            "name": "neovim",
            "buildsystem": "simple",
            "build-commands": [
                "make BUILD_TYPE=\"Unix Makefiles\" CMAKE_BUILD_TYPE=Release USE_BUNDLED_DEPS=OFF CMAKE_EXTRA_FLAGS=\"-DCMAKE_INSTALL_PREFIX=/app\"",
                "make BUILD_TYPE=\"Unix Makefiles\" CMAKE_EXTRA_FLAGS=\"-DCMAKE_INSTALL_PREFIX=/app\" install"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/neovim/neovim",
                    "branch": "v0.2.0"
                }
            ]
        },
        {
            "name": "neovim-gtk",
            "build-options": {
                "build-args": ["--share=network"]
            },
            "buildsystem": "simple",
            "build-commands": [
                "PATH=$PATH:/app/rustc/bin cargo build --release", 
                "PREFIX=\"/app\" make install"			  
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/daa84/neovim-gtk",
                    "branch" : "master"
                }
            ]
        }
    ]
}
