{
    "app-id": "org.daa.NeovimGtk",
    "runtime": "org.gnome.Platform",
    "runtime-version": "3.22",
    "sdk": "org.gnome.Sdk",
    "command": "neovim-gtk",
    "finish-args": [
        /* X11 + XShm access */
        "--share=ipc", "--socket=x11",
        /* Wayland access */
        "--socket=wayland",
        /* We don't want full fs access so we can read the files */
        "--filesystem=host:rw",
        /* Needs to talk to the network: */
        "--share=network",
        /* Enable playing sound thru pulseaudio */
        "--socket=pulseaudio"
    ],
	"cleanup": ["/rustc"],
	"modules": [
      {
            "name":"rust",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://static.rust-lang.org/dist/rust-1.15.1-x86_64-unknown-linux-gnu.tar.gz",
                    "sha256": "b1e7c818a3cc8b010932f0efc1cf0ede7471958310f808d543b6e32d2ec748e7"
                },
                {
                    "type": "script", "commands": ["#!/bin/bash", "#empty configure", "exit 0"],
                    "dest-filename": "configure"
                },
                {
                    "type": "script",
                    "commands": ["all:",
                                 "	echo 'Nothing to do'",
                                 "install:", 
                                 "	./install.sh --prefix=/app/rustc"
                                ],
                    "dest-filename": "Makefile"
                },
                {
                    "type": "shell",
                    "commands": ["chmod +x configure"]
                }
            ]

      },
	  {
		  "name": "neovim",
		  "build-options": {
			  "build-args": ["--share=network"]
		  },
		  "buildsystem": "simple",
		  "build-commands": [
			  "make BUILD_TYPE=\"Unix Makefiles\" CMAKE_EXTRA_FLAGS=\"-DCMAKE_INSTALL_PREFIX=/app\"",
			  "make CMAKE_EXTRA_FLAGS=\"-DCMAKE_INSTALL_PREFIX=/app\" install"
		  ],
		  "sources": [
			  {
				  "type": "git",
				  "url": "https://github.com/neovim/neovim",
				  "tag": "v0.1.7"
			  }
		  ]
	  },
      {
          "name": "neovim-gtk",
		  "buildsystem": "simple",
		  "build-commands": [
			  "mkdir -p .cargo",
			  "cp flatpak/cargo-config.toml .cargo/config",
			  "ln -s flatpak/vendor vendor",
			  "PATH=$PATH:/app/rustc/bin cargo build --release", 
			  "mkdir -p /app/bin", 
			  "cp target/release/neovim-gtk /app/bin/neovim-gtk"
		  ],
          "sources": [
              {
                  "type": "git",
                  "url": "https://github.com/daa84/neovim-gtk",
                  "branch" : "master"
              }
          ]
      }
    ]
}
