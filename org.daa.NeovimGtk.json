{
    "app-id": "org.daa.NeovimGtk",
    "runtime": "org.gnome.Platform",
    "runtime-version": "3.22",
    "sdk": "org.gnome.Sdk",
    "command": "nvim-gtk",
    "rename-desktop-file": "nvim-gtk.desktop",
    "rename-icon": "nvim-gtk",
    "finish-args": [
        /* X11 + XShm access */
        "--share=ipc", "--socket=x11",
        "--socket=wayland",
        /* Full access to filesystem as this is text editor! */
        "--filesystem=host:rw",
		"--filesystem=~/.config/nvim:ro",
        /* Needs to talk to the network: */
        "--share=network",
        /* Enable playing sound thru pulseaudio */
        "--socket=pulseaudio"
    ],
	"cleanup": ["/rustc"],
	"modules": [
      {
            "name":"rust",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://static.rust-lang.org/dist/rust-1.15.1-x86_64-unknown-linux-gnu.tar.gz",
                    "sha256": "b1e7c818a3cc8b010932f0efc1cf0ede7471958310f808d543b6e32d2ec748e7"
                },
                {
                    "type": "script", "commands": ["#!/bin/bash", "#empty configure", "exit 0"],
                    "dest-filename": "configure"
                },
                {
                    "type": "script",
                    "commands": ["all:",
                                 "	echo 'Nothing to do'",
                                 "install:", 
                                 "	./install.sh --prefix=/app/rustc"
                                ],
                    "dest-filename": "Makefile"
                },
                {
                    "type": "shell",
                    "commands": ["chmod +x configure"]
                }
            ]

      },
	  {
		  "name": "libtool",
		  "sources": [
			  {
				  "type": "archive",
				  "url": "http://ftpmirror.gnu.org/libtool/libtool-2.4.6.tar.gz",
				  "sha256": "e3bd4d5d3d025a36c21dd6af7ea818a2afcd4dfc1ea5a17b39d7854bcd0c06e3"
			  }
		  ]
	  },
	  {
		  "name": "neovim",
		  "build-options": {
			  "build-args": ["--share=network"]
		  },
		  "buildsystem": "simple",
		  "build-commands": [
			  "make BUILD_TYPE=\"Unix Makefiles\" CMAKE_EXTRA_FLAGS=\"-DCMAKE_INSTALL_PREFIX=/app\"",
			  "make BUILD_TYPE=\"Unix Makefiles\" CMAKE_EXTRA_FLAGS=\"-DCMAKE_INSTALL_PREFIX=/app\" install"
		  ],
		  "sources": [
			  {
				  "type": "git",
				  "url": "https://github.com/neovim/neovim",
				  "tag": "v0.1.7"
			  }
		  ]
	  },
      {
          "name": "neovim-gtk",
		  "build-options": {
			  "build-args": ["--share=network"]
		  },
		  "buildsystem": "simple",
		  "build-commands": [
			  "PATH=$PATH:/app/rustc/bin cargo build --release", 
			  "PREFIX=\"/app\" make install"			  
		  ],
          "sources": [
              {
                  "type": "git",
                  "url": "https://github.com/daa84/neovim-gtk",
                  "branch" : "master"
              }
          ]
      }
    ]
}
